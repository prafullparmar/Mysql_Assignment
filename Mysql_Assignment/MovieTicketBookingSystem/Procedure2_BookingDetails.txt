CREATE DEFINER=`root`@`localhost` PROCEDURE `BookingDetails`(IN CNAME VARCHAR(45),
                                                                      IN EMAIL VARCHAR(45),
                                                                               IN OPTIONS VARCHAR(45)) BEGIN DECLARE CUSTID INT; DECLARE MOVIEID INT; IF EXISTS
  (SELECT *
   FROM CUSTOMER AS C
   WHERE CustName = CNAME
     AND C.EMAIL = EMAIL ) THEN
SELECT C.CUSTID INTO CUSTID
FROM CUSTOMER AS C
WHERE CustName = CNAME
  AND C.EMAIL = EMAIL; IF STRCMP(OPTIONS, "ALL") =0 THEN
  SELECT CUSTID INTO CUSTID
  FROM CUSTOMER AS C
  WHERE C.CUSTNAME = CNAME
    AND C.EMAIL = EMAIL;
    SELECT T1.TICKETID AS "Ticket ID",
           M.MOVIENAME AS "Movie Name",
           T.THEATRENAME AS "Theatre Name",
           SC.SCREENNAME AS "Screen Number",
           S1.SHOWTIMING AS "Show Timing",
           T1.TICKETCOUNT AS "Ticket Count",
           CONCAT("Rs:", T1.PRICE) AS "Price",
           T1.STATUS AS "Status"
    FROM SHOWS AS S1
    INNER JOIN
      (SELECT *
       FROM TICKET AS TI
       WHERE TI.CUSTID = CUSTID) AS T1 ON T1.SHOWID = S1.SHOWID
    INNER JOIN MOVIE AS M ON M.MOVIEID= S1.MOVIEID
    INNER JOIN SCREEN AS SC ON SC.SCREENID = S1.SCREENID
    INNER JOIN THEATRE AS T ON T.THEATREID= SC.THEATREID; ELSEIF EXISTS
      (SELECT *
       FROM MOVIE AS M
       WHERE M.MOVIENAME = OPTIONS ) THEN
    SELECT M.MOVIEID INTO MOVIEID
  FROM MOVIE AS M
  WHERE M.MOVIENAME = OPTIONS ;
    SELECT CUSTID INTO CUSTID
  FROM CUSTOMER AS C
  WHERE C.CUSTNAME = CNAME
    AND C.EMAIL = EMAIL;
    SELECT T1.TICKETID AS "Ticket ID",
           M.MOVIENAME AS "Movie Name",
           T.THEATRENAME AS "Theatre Name",
           SC.SCREENNAME AS "Screen Number",
           S1.SHOWTIMING AS "Show Timing",
           T1.TICKETCOUNT AS "Ticket Count",
           CONCAT("Rs:", T1.PRICE) AS "Price",
           T1.STATUS AS "Status"
    FROM SHOWS AS S1
    INNER JOIN
      (SELECT *
       FROM TICKET AS TI
       WHERE TI.CUSTID = CUSTID) AS T1 ON T1.SHOWID = S1.SHOWID
    INNER JOIN MOVIE AS M ON M.MOVIEID= S1.MOVIEID
    INNER JOIN SCREEN AS SC ON SC.SCREENID = S1.SCREENID
    INNER JOIN THEATRE AS T ON T.THEATREID= SC.THEATREID WHERE M.MOVIEID = MOVIEID; ELSE
    SELECT "INVALID MOVIE NAME!" AS ""; END IF; ELSEIF STRCMP(CNAME, "ADMIN") = 0
  AND STRCMP(EMAIL, "ADMIN@GMAIL.COM")=0 THEN IF STRCMP(OPTIONS, "ALL")=0 THEN
  SELECT CUSTID INTO CUSTID
  FROM CUSTOMER AS C
  WHERE C.CUSTNAME = CNAME
    AND C.EMAIL = EMAIL;
    SELECT T1.TICKETID AS "Ticket ID",
           C.CUSTID AS "Cust ID",
           C.CUSTNAME AS "Customer Name",
           M.MOVIENAME AS "Movie Name",
           T.THEATRENAME AS "Theatre Name",
           SC.SCREENNAME AS "Screen Number",
           S1.SHOWTIMING AS "Show Timing",
           T1.TICKETCOUNT AS "Ticket Count",
           CONCAT("Rs:", T1.PRICE) AS "Price",
           T1.STATUS AS "Status"
    FROM CUSTOMER AS C
    INNER JOIN TICKET AS T1 ON T1.CUSTID = C.CUSTID
    INNER JOIN SHOWS AS S1 ON T1.SHOWID = S1.SHOWID
    INNER JOIN MOVIE AS M ON M.MOVIEID= S1.MOVIEID
    INNER JOIN SCREEN AS SC ON SC.SCREENID = S1.SCREENID
    INNER JOIN THEATRE AS T ON T.THEATREID= SC.THEATREID; ELSEIF EXISTS
      (SELECT *
       FROM MOVIE AS M
       WHERE M.MOVIENAME = OPTIONS ) THEN
    SELECT CUSTID INTO CUSTID
  FROM CUSTOMER AS C
  WHERE C.CUSTNAME = CNAME
    AND C.EMAIL = EMAIL;
    SELECT T1.TICKETID AS "Ticket ID",
           C.CUSTID AS "Cust ID",
           C.CUSTNAME AS "Customer Name",
           M.MOVIENAME AS "Movie Name",
           T.THEATRENAME AS "Theatre Name",
           SC.SCREENNAME AS "Screen Number",
           S1.SHOWTIMING AS "Show Timing",
           T1.TICKETCOUNT AS "Ticket Count",
           CONCAT("Rs:", T1.PRICE) AS "Price",
           T1.STATUS AS "Status"
    FROM CUSTOMER AS C
    INNER JOIN TICKET AS T1 ON T1.CUSTID = C.CUSTID
    INNER JOIN SHOWS AS S1 ON T1.SHOWID = S1.SHOWID
    INNER JOIN MOVIE AS M ON M.MOVIEID= S1.MOVIEID
    INNER JOIN SCREEN AS SC ON SC.SCREENID = S1.SCREENID
    INNER JOIN THEATRE AS T ON T.THEATREID= SC.THEATREID WHERE M.MOVIENAME = OPTIONS; ELSE
    SELECT "INVALID MOVIE NAME!" AS ""; END IF; ELSE
  SELECT "CUSTOMER CREDENTIALS INVALID!" AS " "; END IF; END